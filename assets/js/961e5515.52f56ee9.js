"use strict";(self.webpackChunkskyhitz=self.webpackChunkskyhitz||[]).push([[558],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},f="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),f=p(n),d=r,h=f["".concat(s,".").concat(d)]||f[d]||c[d]||a;return n?i.createElement(h,l(l({ref:t},u),{},{components:n})):i.createElement(h,l({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,l=new Array(a);l[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[f]="string"==typeof e?e:r,l[1]=o;for(var p=2;p<a;p++)l[p]=n[p];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2146:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>f,frontMatter:()=>a,metadata:()=>o,toc:()=>p});var i=n(7462),r=(n(7294),n(3905));const a={sidebar_position:2},l=void 0,o={unversionedId:"nft-big-query/flow",id:"nft-big-query/flow",title:"flow",description:"There are a few steps in the query nft script.",source:"@site/docs/nft-big-query/flow.md",sourceDirName:"nft-big-query",slug:"/nft-big-query/flow",permalink:"/docs/nft-big-query/flow",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"overview",permalink:"/docs/nft-big-query/overview"},next:{title:"overview",permalink:"/docs/skyhitz-expo-next/overview"}},s={},p=[{value:"Find domains",id:"find-domains",level:3},{value:"Finding issuers",id:"finding-issuers",level:3},{value:"Validate issuers",id:"validate-issuers",level:3},{value:"Check if the beat is original",id:"check-if-the-beat-is-original",level:3},{value:"Index nft",id:"index-nft",level:3}],u={toc:p};function f(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"There are a few steps in the query nft script."),(0,r.kt)("h3",{id:"find-domains"},"Find domains"),(0,r.kt)("p",null,"At first, we are using the big query to find unique domains.\nWe are selecting only domains that are related to at least 10 different accounts."),(0,r.kt)("p",null,"After the big query completes we are querying algolia to check the previous results and compare.\nWe are checking in which domain there are new accounts (possibly nft). We return only those domains\nwith new accounts and save them in algolia."),(0,r.kt)("h3",{id:"finding-issuers"},"Finding issuers"),(0,r.kt)("p",null,"In the next step, we are querying each domain and parsing their ",(0,r.kt)("inlineCode",{parentName:"p"},"stellar.toml")," file."),(0,r.kt)("p",null,"If the domain has ",(0,r.kt)("inlineCode",{parentName:"p"},"ASSET_METADATA_SERVER")," specified we are querying this server to fetch all assets.\nThen we filter those assets by checking if their ",(0,r.kt)("inlineCode",{parentName:"p"},"anchor_asset_type")," is ",(0,r.kt)("inlineCode",{parentName:"p"},"nft"),", and if it is we save this issuer."),(0,r.kt)("p",null,"If the domain has ",(0,r.kt)("inlineCode",{parentName:"p"},"CURRENCIES")," specified we are checking this list for any currency that has the\n",(0,r.kt)("inlineCode",{parentName:"p"},"anchor_asset_type")," set as ",(0,r.kt)("inlineCode",{parentName:"p"},"nft")," and we save corresponding issuers."),(0,r.kt)("p",null,"In the end, we are checking which issuers we checked previously on algolia. We return only issuers that were not checked before.\nThen we update the algolia index."),(0,r.kt)("h3",{id:"validate-issuers"},"Validate issuers"),(0,r.kt)("p",null,"In the last step, for each issuer, we are checking their data for ",(0,r.kt)("inlineCode",{parentName:"p"},"ipfshash"),". If they have provided an ipfs hash we fetch\nmetadata to get more information. We are looking for the following fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"audio"),(0,r.kt)("li",{parentName:"ul"},"animation_url"),(0,r.kt)("li",{parentName:"ul"},"video"),(0,r.kt)("li",{parentName:"ul"},"url")),(0,r.kt)("p",null,"Then we grab those url and make a request for the first 4000 bytes just to validate the mime type. We are allowing the following mime types:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'"video/mp4",'),(0,r.kt)("li",{parentName:"ul"},'"audio/mp4",'),(0,r.kt)("li",{parentName:"ul"},'"audio/wav",'),(0,r.kt)("li",{parentName:"ul"},'"audio/mp3",'),(0,r.kt)("li",{parentName:"ul"},'"audio/mpeg",'),(0,r.kt)("li",{parentName:"ul"},'"audio/vnd.wave",'),(0,r.kt)("li",{parentName:"ul"},'"audio/wave",'),(0,r.kt)("li",{parentName:"ul"},'"audio/x-wav",')),(0,r.kt)("p",null,"We return only valid issuers."),(0,r.kt)("p",null,"For requesting data from ipfs we are using 4 different gateways:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"'",(0,r.kt)("a",{parentName:"li",href:"https://ipfs.io/ipfs/'"},"https://ipfs.io/ipfs/'"),","),(0,r.kt)("li",{parentName:"ul"},"'",(0,r.kt)("a",{parentName:"li",href:"https://cloudflare-ipfs.com/ipfs/'"},"https://cloudflare-ipfs.com/ipfs/'"),","),(0,r.kt)("li",{parentName:"ul"},"'",(0,r.kt)("a",{parentName:"li",href:"https://gateway.ipfs.io/ipfs/'"},"https://gateway.ipfs.io/ipfs/'"),","),(0,r.kt)("li",{parentName:"ul"},"'",(0,r.kt)("a",{parentName:"li",href:"https://gateway.pinata.cloud/ipfs/'"},"https://gateway.pinata.cloud/ipfs/'"))),(0,r.kt)("h3",{id:"check-if-the-beat-is-original"},"Check if the beat is original"),(0,r.kt)("p",null,"// TODO"),(0,r.kt)("p",null,"After validating the file mime type we should check using our Audible service whether the file is original."),(0,r.kt)("h3",{id:"index-nft"},"Index nft"),(0,r.kt)("p",null,"// TODO"),(0,r.kt)("p",null,"When the file is original we should index it using our API"))}f.isMDXComponent=!0}}]);